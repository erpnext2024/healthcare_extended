<div class="nexusuite-popup-wrapper" id="new-patient-popup" style="display:none;">
	<form class="nexusuite-popup-content" id="new-patient-popup-form" method="post"
		  action="/api/method/healthcare_extended.patients_api.submit_patient_form">
		<input type="hidden" name="csrf_token" id="csrf_token">
		<div class="nexusuite-popup-header">
			<h2 class="nexusuite-popup-title">
				<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18"
					 fill="none">
					<path
						d="M16.1932 12.7566V12.5947C16.1916 12.0379 16.0179 11.4952 15.6957 11.041C15.3736 10.5868 14.9189 10.2434 14.3939 10.0578V4.4981H15.2936C15.5322 4.4981 15.761 4.40332 15.9297 4.23461C16.0984 4.0659 16.1932 3.83708 16.1932 3.59848C16.1932 3.35989 16.0984 3.13107 15.9297 2.96236C15.761 2.79364 15.5322 2.69886 15.2936 2.69886H4.49811C4.49811 1.98308 4.21376 1.29661 3.70763 0.790479C3.20149 0.284344 2.51503 0 1.79924 0H0.899622C0.661028 0 0.432206 0.0947812 0.263494 0.263493C0.0947824 0.432204 1.17921e-06 0.661027 1.17921e-06 0.899621C1.17921e-06 1.13822 0.0947824 1.36704 0.263494 1.53575C0.432206 1.70446 0.661028 1.79924 0.899622 1.79924H1.79924C2.03784 1.79924 2.26666 1.89402 2.43537 2.06273C2.60408 2.23145 2.69886 2.46027 2.69886 2.69886V9.37405C1.95551 9.69847 1.31371 10.2179 0.841398 10.8772C0.369083 11.5365 0.0838308 12.3113 0.0158363 13.1195C-0.0521583 13.9277 0.0996354 14.7393 0.455149 15.4683C0.810662 16.1973 1.35667 16.8166 2.03536 17.2607C2.71406 17.7047 3.50019 17.957 4.31055 17.9908C5.12091 18.0246 5.92533 17.8387 6.63867 17.4528C7.352 17.0668 7.94771 16.4951 8.36273 15.7983C8.77774 15.1015 8.99663 14.3054 8.99621 13.4943C8.99705 12.8748 8.86835 12.2619 8.61837 11.6951H13.4943C13.7329 11.6951 13.9617 11.7899 14.1304 11.9586C14.2992 12.1273 14.3939 12.3561 14.3939 12.5947V12.7566C13.7937 12.9688 13.2878 13.3864 12.9657 13.9356C12.6435 14.4847 12.5259 15.13 12.6336 15.7575C12.7412 16.385 13.0672 16.9542 13.554 17.3646C14.0408 17.7749 14.6569 18 15.2936 18C15.9302 18 16.5464 17.7749 17.0331 17.3646C17.5199 16.9542 17.8459 16.385 17.9536 15.7575C18.0612 15.13 17.9436 14.4847 17.6214 13.9356C17.2993 13.3864 16.7934 12.9688 16.1932 12.7566ZM4.49811 16.1932C3.96432 16.1932 3.44252 16.0349 2.9987 15.7383C2.55487 15.4418 2.20895 15.0203 2.00468 14.5271C1.80041 14.034 1.74696 13.4913 1.8511 12.9678C1.95524 12.4443 2.21228 11.9634 2.58972 11.5859C2.96716 11.2085 3.44806 10.9514 3.97158 10.8473C4.49511 10.7432 5.03776 10.7966 5.53092 11.0009C6.02407 11.2052 6.44557 11.5511 6.74213 11.9949C7.03868 12.4387 7.19697 12.9605 7.19697 13.4943C7.19697 14.2101 6.91263 14.8966 6.40649 15.4027C5.90036 15.9088 5.21389 16.1932 4.49811 16.1932ZM12.5947 9.89583H7.19697C6.42054 9.30774 5.47211 8.9916 4.49811 8.99621V8.09659H12.5947V9.89583ZM12.5947 6.29735H4.49811V4.4981H12.5947V6.29735ZM15.2936 16.1932C15.1156 16.1932 14.9417 16.1404 14.7938 16.0416C14.6458 15.9427 14.5305 15.8022 14.4624 15.6378C14.3943 15.4734 14.3765 15.2926 14.4112 15.118C14.4459 14.9435 14.5316 14.7832 14.6574 14.6574C14.7832 14.5316 14.9435 14.4459 15.118 14.4112C15.2926 14.3765 15.4734 14.3943 15.6378 14.4624C15.8022 14.5305 15.9427 14.6458 16.0416 14.7938C16.1404 14.9417 16.1932 15.1156 16.1932 15.2936C16.1932 15.5322 16.0984 15.761 15.9297 15.9297C15.761 16.0984 15.5322 16.1932 15.2936 16.1932ZM4.49811 12.5947C4.32018 12.5947 4.14625 12.6475 3.9983 12.7463C3.85036 12.8452 3.73505 12.9857 3.66696 13.15C3.59887 13.3144 3.58106 13.4953 3.61577 13.6698C3.65048 13.8443 3.73616 14.0046 3.86198 14.1304C3.98779 14.2563 4.14809 14.3419 4.3226 14.3766C4.49711 14.4114 4.67799 14.3935 4.84238 14.3255C5.00676 14.2574 5.14726 14.1421 5.24611 13.9941C5.34496 13.8462 5.39773 13.6722 5.39773 13.4943C5.39773 13.2557 5.30295 13.0269 5.13423 12.8582C4.96552 12.6895 4.7367 12.5947 4.49811 12.5947Z"
						fill="#151684"/>
				</svg>
				New Patient
			</h2>

			<a href="#" class="nexusuite-popup-close">
				<svg xmlns="http://www.w3.org/2000/svg" class="nexusuite-popup-close" width="24"
					 height="24" viewBox="0 0 24 24"
					 fill="none">
					<path
						d="M13.4099 12.0002L17.7099 7.71019C17.8982 7.52188 18.004 7.26649 18.004 7.00019C18.004 6.73388 17.8982 6.47849 17.7099 6.29019C17.5216 6.10188 17.2662 5.99609 16.9999 5.99609C16.7336 5.99609 16.4782 6.10188 16.2899 6.29019L11.9999 10.5902L7.70994 6.29019C7.52164 6.10188 7.26624 5.99609 6.99994 5.99609C6.73364 5.99609 6.47824 6.10188 6.28994 6.29019C6.10164 6.47849 5.99585 6.73388 5.99585 7.00019C5.99585 7.26649 6.10164 7.52188 6.28994 7.71019L10.5899 12.0002L6.28994 16.2902C6.19621 16.3831 6.12182 16.4937 6.07105 16.6156C6.02028 16.7375 5.99414 16.8682 5.99414 17.0002C5.99414 17.1322 6.02028 17.2629 6.07105 17.3848C6.12182 17.5066 6.19621 17.6172 6.28994 17.7102C6.3829 17.8039 6.4935 17.8783 6.61536 17.9291C6.73722 17.9798 6.86793 18.006 6.99994 18.006C7.13195 18.006 7.26266 17.9798 7.38452 17.9291C7.50638 17.8783 7.61698 17.8039 7.70994 17.7102L11.9999 13.4102L16.2899 17.7102C16.3829 17.8039 16.4935 17.8783 16.6154 17.9291C16.7372 17.9798 16.8679 18.006 16.9999 18.006C17.132 18.006 17.2627 17.9798 17.3845 17.9291C17.5064 17.8783 17.617 17.8039 17.7099 17.7102C17.8037 17.6172 17.8781 17.5066 17.9288 17.3848C17.9796 17.2629 18.0057 17.1322 18.0057 17.0002C18.0057 16.8682 17.9796 16.7375 17.9288 16.6156C17.8781 16.4937 17.8037 16.3831 17.7099 16.2902L13.4099 12.0002Z"
						fill="black"/>
				</svg>
			</a>
		</div>
		<div class="nexusuite-popup-body">
			{% for patient_field in patients_fields %}
				{% set field = patient_field %}
				{% include 'templates/common/input-wrapper.html' %}
			{% endfor %}
		</div>

		<div class="nexusuite-popup-footer">
			<a href="/patients-list/new" class="button button-secondary">Edit Full Form</a>
			<button class="button button-primary">Save</button>
		</div>

	</form>
</div>

<script>
	document.addEventListener('DOMContentLoaded', function () {
		document.getElementById('csrf_token').value = frappe.csrf_token;
	});

	document.getElementById('new-patient-popup-form').addEventListener('submit', function (event) {
		event.preventDefault();

		var formData = new FormData(this);

		fetch(this.action, {
			method: 'POST',
			body: formData
		})
			.then(response => response.json())
			.then(data => {
				if (data.message.status === "success")
					location.reload()
			})
			.catch(error => {
				console.error('Error:', error);
				alert('An error occurred: ' + error.message);
			});
	});
</script>
